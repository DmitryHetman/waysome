# JSON API documentation

Waysome is able to get and process messages via a JSON API. The following
chapter documents the API.

In the following chapter, "request" or "message" is used to name a message which
is sent to waysome, containing a JSON object. "transaction" is used to name such
a message which contains "commands" to the software.

## Possible top-level keys

The top level keys of the JSON object are

* "uid", which is meant to be a _unique_ id (generated by the client) to
  identify the transaction. The client has to take care of his UIDs, so they do
  not appear several times. Each client has its own "namespace" here, so two
  clients will not collide if they use the same UID.

* "type", which describes the type of the message. This is currently only the
  string "transaction", more to come.

* "commands", which contains a JSON-Array of Commands.

## Commands

A command in the command array is a JSON object on its own. The key of the
command is always the name of the command, whereas the value of the command are
the arguments of the command:

    { "add": [1, 2] }

The value can be a

* Integer, to tell waysome to use N positions from the stack

* Array, for arguments to the command, whereas
- "null" is NIL
- "true"/"false" as booleans
- Integers as integers
- Doubles as doubles (not supported yet)
- Strings as strings
- Arrays to specify a set
- An object: '{ "pos": 1 }' to refer to a position on the stack (first in this
  case)
- An object: '{ "name": "a name", "value": <value> }' for a named value, whereas
  the name is a string and the value can be one out of this list.

Of course you can mix objects and integers in the array, if the related command
takes them.

For example:

    { "pop": 4 }

Pop four positions from the stack,

    { "pop": [{ "pos": -1 }] }

means "Pop the first value on top of the stack", but

    { "pop": [ 1 ] }

does not make sense, as the argument to "pop" is a constant.

## Summary

All in all, we can now describe a simple request to waysome. The following
request pushes the numbers 1 and 2 onto the stack and then adds them. As waysome
returns the last value on the stack, the request should return a message
containing a integer value 3.

    {
        "UID": "my awesome uid",
        "commands": [
            { "push": [ 1 ] },
            { "push": [ 2 ] },
            { "add": [ { "pos": -1 }, { "pos": -2 } ] }
        ]
    }

The possible commands are not in scope of this document.
The return format is a TODO for this document.
