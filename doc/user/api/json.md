# JSON API documentation

Waysome is able to get and process messages via a JSON API. The following
chapter documents the API.

In the following chapter, "request" or "message" is used to name a message which
is sent to waysome, containing a JSON object. "transaction" is used to name such
a message which contains "commands" to the software.

## Possible top-level keys

The top level keys of the JSON object are

* "uid", which is meant to be a _unique_ id (generated by the client) to
  identify the transaction. The client has to take care of his UIDs, so they do
  not appear several times. Each client has its own "namespace" here, so two
  clients will not collide if they use the same UID.

* "type", which describes the type of the message. This is currently only the
  string "transaction", more to come.

* "commands", which contains a JSON-Array of Commands.

## Commands

A command in the command array is a JSON object on its own. The key of the
command is always the name of the command, whereas the value of the command are
the arguments of the command:

    { "add": [1, 2] }

The arguments are

* Integers, to tell waysome to use N positions from the stack

* Integers in an array, to refer to positions on the execution stack, whereas
  positive values are positions in the stack from the _bottom_ to the _top_ of
  the stack and negative values are from the _top_ to the _bottom_ of the stack.

* Objects, to pass constants to the command.

For example:

    { "pop": 4 }

Pop four positions from the stack,

    { "pop": [-1] }

means "Pop the first value on top of the stack", but

    { "pop": [ { "int": 1 } ] }

does not make sense, as the argument to "pop" is a constant.

As the previous example shows, the arguments can be constants. These constants
are described using another JSON object, whereas the _key_ is the _type_ and the
_value_ is the _value_. Possible types are

* "nil", whereas the _value_ of the object should then be "null"
* "bool", whereas the _value_ of the object should then be one of "true",
  "false" (as JSON literals), 0 or 1
* "int", whereas the _value_ of the object is a number
* "string", whereas the _value_ of the object should be a string

More values to come.

## Summary

All in all, we can now describe a simple request to waysome. The following
request pushes the numbers 1 and 2 onto the stack and then adds them. As waysome
returns the last value on the stack, the request should return a message
containing a integer value 3.

    {
        "UID": "my awesome uid",
        "commands": [
            { "push": [ { "int": 1 } ] },
            { "push": [ { "int": 2 } ] },
            { "add": [ -1, -2 ] }
        ]
    }

The possible commands are not in scope of this document.
The return format is a TODO for this document.
