\subsection{JSON API documentation}

    Waysome is able to get and process messages via a JSON API. The following
    chapter documents the API.

    In the following chapter, "request" or "message" is used to name a message
    which is sent to waysome, containing a JSON object. "transaction" is used to
    name such a message which contains "commands" to the software.

    \subsubsection{Possible top-level keys}

        The top level keys of the JSON object are

        \begin{itemize}
            \item ``UID'', which is meant to be a \emph{unique} id (generated by
                the client) to identify the transaction. The client has to take
                care of his UIDs, so they do not appear several times. Each
                client has its own "namespace" here, so two clients will not
                collide if they use the same UID.  A UID is a number.

            \item ``type'', which describes the type of the message. This is
                currently only the string "transaction", more to come.

            \item ``CMDS'', which contains a JSON-Array of Commands.
        \end{itemize}

    \subsubsection{Commands}

        A command in the command array is a JSON object on its own. The key of
        the command is always the name of the command, whereas the value of the
        command are the arguments of the command:

        \begin{lstlisting}[language=json]
            { "add": [1, 2] }
        \end{lstlisting}

        The value can be a

        \begin{itemize}
            \item Integer, to tell waysome to use N positions from the stack

            \item Array, for arguments to the command, whereas

            \begin{itemize}
                \item "null" is NIL
                \item "true"/"false" as booleans
                \item Integers as integers
                \item Doubles as doubles (not supported yet)
                \item Strings as strings
                \item Arrays to specify a set
                \item An object: '{ "pos": 1 }' to refer to a position on the
                    stack (first in this case)
                \item An object: '{ "name": "a name", "value": <value> }' for a
                    named value, whereas the name is a string and the value can
                    be one out of this list.
            \end{itemize}
        \end{itemize}

        Of course you can mix objects and integers in the array, if the related
        command takes them.

        For example:

        \begin{lstlisting}[language=json]
            { "pop": 4 }
        \end{lstlisting}

        Pop four positions from the stack,

        \begin{lstlisting}[language=json]
            { "pop": [{ "pos": -1 }] }
        \end{lstlisting}

        means "Pop the first value on top of the stack", but

        \begin{lstlisting}[language=json]
            { "pop": [ 1 ] }
        \end{lstlisting}

        does not make sense, as the argument to "pop" is a constant.

    \subsubsection{Summary}

        All in all, we can now describe a simple request to waysome. The
        following request pushes the numbers 1 and 2 onto the stack and then
        adds them. As waysome returns the last value on the stack, the request
        should return a message containing a integer value 3.

        \begin{lstlisting}[language=json]
            {
                "UID": 123,
                "CMDS": [
                    { "push": [ 1 ] },
                    { "push": [ 2 ] },
                    { "add": [ { "pos": -1 }, { "pos": -2 } ] }
                ]
            }
        \end{lstlisting}

        The possible commands are not in scope of this document.
        The return format is a TODO for this document.
